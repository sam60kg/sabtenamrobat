import telebot
from flask import Flask, request

# ุชูฺฉู ุฑุจุงุช
API_TOKEN = '7174774942:AAGaPSfnHdN21Vv85yxSRX13Th5jd29-wMA'
bot = telebot.TeleBot(API_TOKEN)

# ูุชุบุฑูุง
max_tour_capacity = 8
max_personal_capacity = 20
registered_users = []
waiting_list = []

# ุชุงุจุน ุจุฑุง ุงุฑุณุงู ูพุงู ุฎูุดุงูุฏ ุจู ฺฉุงุฑุจุฑุงู
def welcome_message(user_id, user_type):
    if user_type == "tour":
        message = (
            "ุณูุงู ู ุฎูุด ุงููุฏ ุจู ุจุฑูุงูู ุฏูุณุชุงูู ุฏุฑฺฉู ๐ฟ๐\n"
            "ุธุฑูุช ุณุฑูุณ ุชูุฑ ุชฺฉูู ุดุฏูุ ูู ุฎูุดุญุงู ูโุดู ฺฉู ุจุง ูุณูู ุดุฎุต ุฎูุฏุช ููุฑุงู ูุง ุจุงุด.\n"
            "ุญุชูุงู ูุณุงู ุถุฑูุฑ ูุซู ฺฉูุด ู ูุจุงุณ ููุงุณุจุ ฺูุจโุฏุณุชุ ุขุจ ู ฺฉ ูุนุฏู ุบุฐุง ุจุฑุง ุตุจุญุงูู ุฑู ููุฑุงู ุฏุงุดุชู ุจุงุด.\n"
            "ุญุฑฺฉุช ุงุฒ ูพุง ูุณุฑ ุฏุฑฺฉู ุณุงุนุช ท:ณฐ ุตุจุญ ุดุฑูุน ูุดู ู ฺฉู ุจุฑูุงูู ุชุง ุณุงุนุช ฒ:ณฐ ุจุนุฏ ุงุฒ ุธูุฑ ุชููู ูุดู.\n"
            "ูุทูุงู ุฑุฃุณ ุณุงุนุช ท:ฑต ุฏุฑ ูพุง ูุณุฑ ุฏุฑฺฉู ุญุงุถุฑ ุจุงุด.\n"
            "ููุชุธุฑุช ูุณุชู ู ุงูุฏูุงุฑู ฺฉู ู ุฑูุฒ ุนุงู ุฏุงุดุชู ุจุงุด! ๐\n"
            "(ุฑุงูููุง ุชู ุจุนุฏ ุงุฒ ุชููู ุดุฏู ูููุช ูุงูุ ููฺฉุดู ุฏูู ูุญู ูพูุณุชูุช ุจู ฺฏุฑูู ุจู ููุฑุงู ุงุทูุงุนุงุช ุจุดุชุฑ ุฑู ุจูุช ุงุนูุงู ูโฺฉูู)\n"
            "ุงฺฏุฑ ุจู ุฑุงูููุง ููุฑ ูุงุฒ ุฏุงุฑ ุจุง 09901243254 ุชูุงุณ ุจฺฏุฑ."
        )
    elif user_type == "fully_booked":
        message = (
            "ุณูุงู! ๐โโ๏ธ\n"
            "ูุชุฃุณูุงูู ุธุฑูุช ุชูุฑ (ูู ุณุฑูุณ ู ูู ููุฑุงู ุจุง ูุณูู ุดุฎุต) ุชฺฉูู ุดุฏู. ุงูุฏูุงุฑู ุฏุฑ ุจุฑูุงููโูุง ุจุนุฏ ูุง ุจุชูู ุดุฑฺฉุช ฺฉู!\n"
            "(ุฑุงูููุง ุชู ุจุนุฏ ุงุฒ ุชููู ุดุฏู ูููุช ุซุจุชโูุงูุ ุงุทูุงุนุงุช ุจุดุชุฑ ุฏุฑุจุงุฑู ุจุฑูุงููโูุง ุขูุฏู ุจูุช ุงุนูุงู ูโฺฉูู.)\n"
            "ุงฺฏุฑ ุจู ุฑุงูููุง ููุฑ ูุงุฒ ุฏุงุฑ ุจุง 09901243254 ุชูุงุณ ุจฺฏุฑ."
        )
    elif user_type == "personal":
        message = (
            "ุณูุงู ู ุฎูุด ุงููุฏ ุจู ุจุฑูุงูู ุฏูุณุชุงูู ุฏุฑฺฉู ๐ฟ๐\n"
            "ุธุฑูุช ุณุฑูุณ ุชูุฑ ุชฺฉูู ุดุฏูุ ูู ุฎูุดุญุงู ูโุดู ฺฉู ุจุง ูุณูู ุดุฎุต ุฎูุฏุช ููุฑุงู ูุง ุจุงุด.\n"
            "ุญุชูุงู ูุณุงู ุถุฑูุฑ ูุซู ฺฉูุด ู ูุจุงุณ ููุงุณุจุ ฺูุจโุฏุณุชุ ุขุจ ู ฺฉ ูุนุฏู ุบุฐุง ุจุฑุง ุตุจุญุงูู ุฑู ููุฑุงู ุฏุงุดุชู ุจุงุด.\n"
            "ุญุฑฺฉุช ุฑุฃุณ ุณุงุนุช ถ ุตุจุญ ุงุฒ ุฎุงุจูู ฺฏูุดูุฑ ูุฑุณุฏู ุจู ูุฑูุฏ ุงุชูุจุงูุ ู ูพูุงุดููู ุญุฏูุฏ ุณุงุนุช ท:ณฐ ุดุฑูุน ูุดู.\n"
            "ฺฉู ุจุฑูุงูู ุชุง ุณุงุนุช ฒ:ณฐ ุจุนุฏ ุงุฒ ุธูุฑ ุทูู ูโฺฉุดู.\n"
            "ููุชุธุฑุช ูุณุชู ู ุงูุฏูุงุฑู ฺฉู ู ุฑูุฒ ุนุงู ุฏุงุดุชู ุจุงุด! ๐\n"
            "(ุฑุงูููุง ุชู ุจุนุฏ ุงุฒ ุชููู ุดุฏู ูููุช ูุงูุ ููฺฉุดู ุฏูู ูุญู ูพูุณุชูุช ุจู ฺฏุฑูู ุจู ููุฑุงู ุงุทูุงุนุงุช ุจุดุชุฑ ุฑู ุจูุช ุงุนูุงู ูโฺฉูู)\n"
            "ุงฺฏุฑ ุจู ุฑุงูููุง ููุฑ ูุงุฒ ุฏุงุฑ ุจุง 09901243254 ุชูุงุณ ุจฺฏุฑ."
        )
    elif user_type == "waiting":
        message = (
            "ุณูุงู! ๐\n"
            "ุฎูุดุจุฎุชุงูู ู ุฌุง ุชู ุณุฑูุณ ุชูุฑ ุฎุงู ุดุฏ ู ุชู ุงูุงู ุฌุฒู ููุฑุงุช ุฑุฒุฑู ูุณุช ฺฉู ูโุชูู ุจุง ุณุฑูุณ ูุง ุจู ุฏุฑฺฉู ุจุง. ๐\n"
            "ุงฺฏู ูุณูู ุดุฎุต ุฏุงุฑ ูู ูุดฺฉู ูุณุชุ ูโุชูู ุจุง ูุณูู ุฎูุฏุช ูู ุจุง ู ูุง ุฑู ููุฑุงู ฺฉู.\n"
            "ููุชุธุฑุช ูุณุชู! ๐\n"
            "(ุฑุงูููุง ุชู ุจุนุฏ ุงุฒ ุชููู ุดุฏู ูููุช ูุงูุ ููฺฉุดู ุฏูู ูุญู ูพูุณุชูุช ุจู ฺฏุฑูู ุจู ููุฑุงู ุงุทูุงุนุงุช ุจุดุชุฑ ุฑู ุจูุช ุงุนูุงู ูโฺฉูู)\n"
            "ุงฺฏุฑ ุจู ุฑุงูููุง ููุฑ ูุงุฒ ุฏุงุฑ ุจุง 09901243254 ุชูุงุณ ุจฺฏุฑ."
        )
    
    bot.send_message(user_id, message)

# ุงูพูฺฉุดู Flask ุจุฑุง Webhook
app = Flask(__name__)

# ุฏุฑุงูุช ุขูพุฏุชโูุง ุงุฒ Telegram
@app.route('/' + API_TOKEN, methods=['POST'])
def get_message():
    json_str = request.get_data().decode('UTF-8')
    update = telebot.types.Update.de_json(json_str)
    bot.process_new_updates([update])
    return "!", 200

# ุชูุธู Webhook
@app.route("/")
def webhook():
    bot.remove_webhook()
    bot.set_webhook(https://sabtenamrobat-fp62gyrsj-00989901243254s-projects.vercel.app
/" + API_TOKEN)
    return "Webhook set!", 200

if __name__ == "__main__":
    app.run(host="0.0.0.0", port=int(os.environ.get('PORT', 5000)))
